# @title Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


import os
# We use the core google-genai library classes here, which are more stable
from google import genai
from google.genai import types

# --- 1. API Key Setup (Required for all Codelabs) ---
try:
    from kaggle_secrets import UserSecretsClient
    GOOGLE_API_KEY = UserSecretsClient().get_secret("GOOGLE_API_KEY")
    os.environ["GOOGLE_API_KEY"] = GOOGLE_API_KEY
    os.environ["GOOGLE_GEMINI_USE_VERTEXAI"] = "FALSE"
    
    # Instantiate the client using the key
    client = genai.Client(api_key=GOOGLE_API_KEY)
    print("✅ Gemini API client configured successfully.")
except Exception as e:
    print(f"❌ Configuration Error: {e}. Check your API Key setup.")

# --- 2. Grounding Model Instantiation ---

# Day 4A is about using real-world data, achieved via the Google Search tool.
# We configure the model to use the built-in search tool.
if 'client' in locals():
    print("\n--- Creating the Grounding Model ---")
    
    # The modern, stable way to enable Google Search for grounding is via the tools list.
    grounding_model = client.models.get(
        model='gemini-2.5-flash',
        config=types.GenerateContentConfig(
            tools=[{"googleSearch": {}}]  # This is the stable JSON-like structure for grounding
        )
    )

    print("Grounding model created and equipped with Google Search.")

# --- 3. Running the Grounding Query ---

    search_query = "What were the biggest announcements from the most recent Google I/O event?"
    print(f"\nUser Query: {search_query}")

    # Use the client to generate content with the grounding model
    response = client.models.generate_content(
        model='gemini-2.5-flash',
        contents=search_query,
        config=types.GenerateContentConfig(
            # Pass the search tool directly in the config for execution
            tools=[{"googleSearch": {}}]
        )
    )
    
    print("\nGrounding Response:")
    print(response.text)

else:
    print("\nModel execution skipped due to API configuration error.")
